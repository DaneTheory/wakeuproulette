{% extends 'userena/base_userena.html' %}
{% load i18n %}
{% load url from future %}

{% block title %}{% blocktrans with profile.user.username as username %}{{ username }}'s profile.{% endblocktrans %}{% endblock %}
{% block content_title %}<h2 xmlns="http://www.w3.org/1999/html">{{ profile.get_full_name_or_username |title }})</h2>{% endblock %}

{% block dashboard %}
<link rel="stylesheet" type="text/css" href="/media/css/dashboard.css">
<script type="text/javascript" src="/media/js/dashboard.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.js"></script>
<script type="text/javascript" src="/media/js/charts.js"></script>

<div id="dashboard" onload="startTime();">
    <div id="dash-head" class="wakeup-box-shadow">
        <div id="dash-profile" class="inline">
            <div class="title">{{ name }}</div>
            <img id="profile-picture" class="wakeup-box-shadow" src="{{ profileurl }}"/>
            <div id="aura-points">Aura Points: {{ aura }}</div>
        </div>
        <div id="dash-stats" class="inline">
            <div id="dash-stats-title" class="title">WakeUp Stats</div>
            <table id="global-stats">
                <tr>
                    <td>Total WakeUps:</td>
                    <td>{{ totalcalls }}</td>
                </tr>
                <tr>
                    <td>Talk Time:</td>
                    <td>{{ recordingduration }}</td>
                </tr>
                <tr>
                    <td>Recording Plays:</td>
                    <td>{{ recordingplays }}</td>
                </tr>
                <tr>
                    <td>Recording Aura:</td>
                    <td>{{ recordingaura }}</td>
                </tr>
            </table>
            <div id="chart"></div>
        </div>
        <div id="dash-settings" class="inline">
            <div id="dash-time"></div>
            <div id="dash-alarm">Alarm: 06:00</div>
        </div>
    </div>

    <div id="dash-body">
        <div id="contacts" class="dash-block wakeup-box-shadow" data-accept_request_url="{% url 'accounts.ajax.accept_request' %}" data-ignore_request_url="{% url 'accounts.ajax.ignore_request' %}">
            <div class="title">Contacts</div>
            <div id="contacts-box">
            	<button id="all_contacts_btn">All</button><button id="requests_btn">Requests</button>
            	<div id="all_contacts" style="height:400px;overflow-y:auto;overflow-x:hidden;padding-top:10px;">
            		{% for contact in request.user.profile.get_contacts %}
            			{% include 'layouts/contact.html' with contact=contact %}
            		{% endfor %}
            	</div>
            	<div id="requests" style="display:none;height:400px;overflow-y:auto;overflow-x:hidden;padding-top:10px;">
            		{% for request in request.user.profile.get_requests %}
            			{% include 'layouts/request.html' with request=request %}
            		{% endfor %}
            	</div>
            </div>
        </div>
        <div id="recordings" class="dash-block wakeup-box-shadow" data-increment_rec_aura_url="{% url 'accounts.ajax.increment_rec_aura' %}" data-increment_rec_rewake_url="{% url 'accounts.ajax.increment_rec_rewake' %}" data-increment_rec_play_url="{% url 'accounts.ajax.increment_rec_play' %}">
            <div class="title">My WakeUp Diary</div>
            <div id="recordings-box">
                {% for rec in recordings %}
                <div idx="{{ rec.pk }}" class="recording">
                    <img class="inline wakeup-box-shadow recording-img" src="{{ rec.other.call.user.profile.img_url }}">
                    <div class="inline recording-audio-section">
                        <div class="recording-info">
                            <span class="recording-username"><a href="#">{{ rec.other.call.user.profile.get_full_name_or_username |title }}</a></span>
                            <span class="recording-publish"><a href="#">[Publish]</a></span>
                            <span class="recording-privacy">[{{ rec.get_privacy_display }}]</span>
                        </div>
                        <audio controls class="recording-audio"  class="inline">
                            <source src="{{ rec.recordingurl }}" type="audio/x-wav">
                            Please use a Chrome or Firefox to listen to your recordings
                        </audio>
                    </div>
                    <div class="recording-data">
                            <div title="Aura" class="tooltip aura-button"><img src="/media/icons/like-white.png"/><span>{{ rec.rating }}</span></div>
                            <div title="Re-wakes" class="tooltip rewakes-button"><img src="/media/icons/rewakeup-white.png"/><span>0</span></div>
                            <div title="Play Count" class="tooltip play-count"><img src="/media/icons/views-white.png"/><span>{{ rec.plays }}</span></div>
                    </div>
                    <div class="comments-section">
                        <textarea placeholder="Write a comment..." class="comment-textarea"></textarea>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div id="badges" class="dash-block wakeup-box-shadow">
            <div class="title">Badges</div>
        </div>
    </div>
</div>
<script>
    $(function() {
        $("#chart").chart({
            template: "pie_basic_1",
            values: {
                serie1: [{{ wokeup }}, {{ snoozed }}, {{ overslept }}]
            },
            labels: ["1", "2", "3"],
            legend: ["Woke Up", "Snoozed", "Over-slept"],
            tooltips: {
                serie1: ["Woke Up:<br><strong>66 times</strong>", "Snoozed:<br><strong>87 times</strong>", "Over-slept:<br><strong>10 times</strong>"]
            },
            defaultSeries: {
                values: [{
                    plotProps: {
                        fill: "green"
                    }
                }, {
                    plotProps: {
                        fill: "blue"
                    }
                }, {
                    plotProps: {
                        fill: "black"
                    }
                }]
            }
        });

    });

    $.elycharts.templates['pie_basic_1'] = {
        type: "pie",
        defaultSeries: {
            plotProps: {
                stroke: "white",
                "stroke-width": 2,
                opacity: 0.8
            },
            highlight: {
                move: 20
            },
            tooltip: {
                frameProps: {
                    opacity: 0.5
                }
            },
            startAnimation: {
                active: true,
                type: "grow"
            }
        },
        features: {
            legend: {
                horizontal: false,
                width: 90,
                height: 80,
                x: 282,
                y: 100,
                borderProps: {
                    "fill-opacity": 0.3
                }
            }
        }
    };


</script>
{% endblock %}
